<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-icons/av-icons.html">
<link href='//fonts.googleapis.com/css?family=Roboto:700,400,100' rel='stylesheet'
      type='text/css'>
<!--
Represents each media element in the queue.

Uses the following chrome.cast.media.Media.media.items.metadata fields:

"title": "Big Buck Bunny",
"subtitle": "Blender Foundation",
"images": [
  {
    "url": "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg"
  }
]

Clicking on the item jumps the chromecast receiver to the current item.

Clicking on the X remove the item from queue

If the currently playing cast item id matches this item, the now playing background color is
used.

-->
<polymer-element name="controller-bar-media-element">
  <template>
    <style>
      :host {
        height: 60px;
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        cursor: pointer;
        background-color: #ffffff;
      }

      #thumbnail {
        display:flex;
        order: 1;
        height:50px;
        width:50px;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: 50% 50%;
        padding: 0;
        margin-left: 10px;
        justify-content: center;
        align-items: center;
      }

      #details {
        max-width:250px;
        margin-left:10px;
        display: flex;
        order: 2;
        flex-grow: 10;
        flex-direction: column;
        cursor:pointer;
        justify-content: center;
      }

      label {
        display: block;
        cursor:pointer;
        font-family: 'Roboto', sans-serif;
      }

      #sub_title {
        font-weight:100;
        font-size:1em;
      }

      .title {
        font-weight:400;
        font-size:1.2em;
      }

      #button_clear {
        display: flex;
        order: 4;
        justify-content: center;
        flex-grow: 1;
        min-width: 1em;
      }

      .hidden {
        display:none;
      }

      #play {
        opacity: .8;
        width: 50px;
        height: 50px;
        fill:#ffffff;
      }
    </style>

    <div id="thumbnail">
      <core-icon id="play" icon="av:play-arrow" class="hidden"></core-icon>
    </div>
    <div id="details">
      <label id="title">{{ media.media.metadata.title }}</label>
      <label id="sub_title">{{ media.media.metadata.subtitle }}</label>
    </div>

    <paper-button id="button_clear">
      <core-icon id="icon_clear"
                 icon="clear"></core-icon>
    </paper-button>

  </template>
  <script>
    Polymer("controller-bar-media-element", {
      publish:  {
        /**
         * Media content to display.
         */
        media: null,
        /**
         * Shared MediaStatus state.
         */
        mediaStatus: null,
        /**
         * Background color when element is playing.
         */
        playingBackgroundColor: '#eaeaea',
        /**
         * Background color when element is idle.
         */
        idleBackgroundColor: '#ffffff'
      },
      observe: {
        'mediaStatus.castMedia.currentItemId': 'currentlyPlayingObserver'
      },
      ready: function() {
        //Set the thumbnail background
        this.$.thumbnail.style.backgroundImage =  "url('" + this.media.media.metadata.images[0].url +
        "')";
        //Handle queue removal clicks
        this.$.button_clear.addEventListener('click', function() {
          this.mediaStatus.removeFromQueue(this.media.itemId);
        }.bind(this));

        //On mouse overs display the play notification
        this.addEventListener('mouseover', function(){
          this.$.play.classList.remove('hidden');
        });
        this.addEventListener('mouseout', function() {
          this.$.play.classList.add('hidden');
        });

        //Handle clicks to play the selected content.
        this.addEventListener('click', function() {
          this.mediaStatus.playItemInQueue(this.media.itemId);
        })
      },
      /**
       * Observes the currently playing Cast item.  If the itemId matches this media.itemId
       * update the background.
       * @param oldVal
       * @param newVal
       */
      currentlyPlayingObserver: function(oldVal, newVal) {
        if(this.media.itemId === newVal) {
          this.style.backgroundColor = this.playingBackgroundColor;
        } else {
          this.style.backgroundColor = this.idleBackgroundColor;
        }
      }
    });
  </script>
</polymer-element>
